!function(){function e(){this.rules=[],this.ruleFuns={require:function(e,t){if(!e||0===e.length)return t}}}Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){if(null==this)throw new TypeError("Array.prototype.indexOf() - can't convert `"+this+"` to object");var n=isFinite(t)?Math.floor(t):0,o=this instanceof Object?this:new Object(this),a=isFinite(o.length)?Math.floor(o.length):0;if(n>=a)return-1;if(n<0&&(n=Math.max(a+n,0)),void 0===e){do{if(n in o&&void 0===o[n])return n}while(++n<a)}else do{if(o[n]===e)return n}while(++n<a);return-1}),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){var n,o;if(null==this)throw new TypeError(" this is null or not defined");var a=Object(this),r=a.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(n=t),o=0;o<r;){var s;o in a&&(s=a[o],e.call(n,s,o,a)),o++}}),e.prototype={constructor:e,addRule:function(e,t,n){e.addEvent("focus",function(){e.removeClass("error")});var o=this;this.rules.push(function(){var a=t.split(":"),r=o.ruleFuns[a.shift()];a.unshift(e.value),a.push(n);var s=r.apply(this,a);if(s)return e.addClass("error"),s})},validate:function(){for(var e,t=0;e=this.rules[t++];){var n=e();if(n)return n}}};var t=function(e,n){function o(e){if(e.isEle)return e;e.isEle=!0;var n={prototype:Element,val:function(e){return"string"==typeof e?this.value=e:this.value},html:function(e){return"string"==typeof e?this.innerHTML=e:this.innerHTML},next:function(){for(var e=this.nextSibling;e instanceof Text;)e=e.nextSibling;return t(e)},addClass:function(e){return classArray=this.className.split(" "),-1==classArray.indexOf(e)&&(this.className+=" "+e),this},removeClass:function(e){if(classArray=this.className.split(" "),-1!=classArray.indexOf(e))return classArray.splice(classArray.indexOf(e),1),this.className=classArray.join(" "),this},hasClass:function(e){return classArray=this.className.split(" "),classArray.indexOf(e)>-1},ele:function(e){return t(e,this)},getInput:function(e){return this.ele("input[name="+e+"]")[0]},addEvent:function(e,t){return this.addEventListener?this.addEventListener(e,t):this.attachEvent&&this.attachEvent("on"+e,function(e){(e=e||window.event).target=e.target||e.srcElement,t(e)}),this},target:function(e){if("string"==typeof e)if(document.dispatchEvent){var t=document.createEvent("HTMLEvents");t.initEvent(e,!0,!0),this.dispatchEvent(t)}else document.attachEvent&&this.fireEvent("on"+e);return this}};if(e.__proto__)n.__proto__=e.__proto__,e.__proto__=n;else for(var o in n)e[o]=n[o];return e}if(!e)return e;if("string"!=typeof e&&e instanceof Element)return o(e);var a;if(n=n||document,(a=2==e.split("#").length?document.getElementById(e.split("#")[1]):n.querySelectorAll(e))instanceof Element)a=o(a);else{if(!a)return console.log("unknow ele type ",e),null;for(var r=0;r<a.length;r++)o(a[r]);a.call=function(e,t,n){for(var o=0;o<a.length;o++)a[o][e](t,n)}}return a},n=function(e){this.modalTimer=null,this.vaptchaObj=null,this.form=t(document.body),this.options=e||{}};n.prototype={constructor:n,isPhone:function(e){return e.trim().length>5},showMsg:function(e,t){var n=t?".vaptcha-tip-success":".vaptcha-tip-warn";this.modalTimer&&clearTimeout(this.modalTimer),box=this.form.ele(".vaptcha-tip-cont")[0],box.style.zIndex="10000",modal=this.form.ele(n)[0],modal.removeClass("none"),box.removeClass("none"),modal.ele(".dz-tip-text")[0].innerHTML=e,this.modalTimer=setTimeout(function(){box.addClass("none"),modal.addClass("none")},1500)},getFormData:function(e){for(var t=e.ele("input"),n={},o=0;o<t.length;o++)t[o].name&&(n[t[o].name]=t[o].value);return n},stopDefault:function(e){e&&e.preventDefault?(e.stopPropagation(),e.preventDefault()):(e.cancelBubble=!0,e.returnValue=!1)},ajax:function(e){var t,n=e.url,o=e.success,a=e.error,r=e.type||"GET",s=e.data||null;window.ActiveXObject?t=new ActiveXObject("Microsoft.XMLHTTP"):window.XMLHttpRequest&&(t=new XMLHttpRequest),t.open(r,this.options.site_url+n),"undefined"==typeof FormData&&t.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),t.send(function(e){if("object"!=typeof e)return e;if("function"==typeof FormData){var t=new FormData;for(var n in e)t.append(n,e[n]);return t}var o=new Array,a=0;for(var n in e)o[a]=encodeURIComponent(n)+"="+encodeURIComponent(e[n]),a++;return o.join("&")}(s)),t.onreadystatechange=function(e){if(4===t.readyState){var n=t.responseText;try{n=JSON.parse(n)}catch(e){n.split("'").forEach(function(e){/^[\u4e00-\u9fa5]+/g.test(e)&&(n=e)})}200===t.status&&200===n.status?o&&o(n):a&&a(n)}}},initVaptcha:function(e){var t=this,n=(e.form,e.success);e.scene=e.scene||"";var o=new function(){this.isPass=!1,this.vaptcha=null,this.refresh=function(){this.vaptcha.reset()}},a=function(){var a={vid:t.options.vid,container:e.element,type:e.type||"float",style:t.options.vaptcha_style||"dark",https:e.https||!1,color:t.options.vaptcha_color||"#3c8aff",lang:"zh-CN",scene:e.scene};window.vaptcha(a).then(function(e){e.listen("pass",function(){o.isPass=!0,n&&n()}),e.listen("mounted",function(){e.renderTokenInput()}),o.vaptcha=e,o.vaptcha.render()})},r=document.getElementById("vaptcha_v_js");return r&&window.vaptcha&&r.loaded?a():(r=document.createElement("script"),protocol="https",r.src=protocol+"://cdn.vaptcha.com/v2.js",r.id="vaptcha_v_js",r.async=!0,r.onload=r.onreadystatechange=function(){this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(a(),r.loaded=!0,r.onload=r.onreadystatechange=null)},document.getElementsByTagName("head")[0].appendChild(r)),o},resetSendCodeBtn:function(e){this.countDownTimer&&clearTimeout(this.countDownTimer),e.innerText=this.options.lang.send_code,e.removeAttribute("disabled")},buttonCountDown:function(e,t){var n=this;t=t||120,e.setAttribute("disabled","disabled"),this.countDownTimer&&clearTimeout(this.countDownTimer),function o(){if(0==t)return e.removeAttribute("disabled"),void(e.innerText=n.options.lang.send_code);e.innerText=t+"s",t--,n.countDownTimer=setTimeout(o,1e3)}()},passwordLevel:function(e,t){e.addEvent("keyup",function(n){n=n||window.event;var o=new RegExp("^(?=.{8,})(?=.*[A-Z])(?=.*[a-z])(?=.*[0-9])(?=.*\\W).*$","g"),a=new RegExp("^(?=.{7,})(((?=.*[A-Z])(?=.*[a-z]))|((?=.*[A-Z])(?=.*[0-9]))|((?=.*[a-z])(?=.*[0-9]))).*$","g"),r=(new RegExp("(?=.{6,}).*","g"),new RegExp("[a-zA-Z]"));e.value.length>=6?o.test(e.value)?(t.removeClass("pw-medium"),t.removeClass("pw-weak"),t.addClass("pw-strong"),canBeSubmit=!0):a.test(e.value)||r.test(e.value)?(t.removeClass("pw-strong"),t.removeClass("pw-weak"),t.addClass("pw-medium"),canBeSubmit=!0):(t.removeClass("pw-strong"),t.removeClass("pw-medium"),t.addClass("pw-weak"),canBeSubmit=!1):e.value.length>0&&e.value.length<6?(t.removeClass("pw-strong"),t.removeClass("pw-medium"),t.addClass("pw-weak"),canBeSubmit=!1):(t.removeClass("pw-strong"),t.removeClass("pw-medium"),t.removeClass("pw-weak"),canBeSubmit=!1),13==n.keyCode&&signUp()})},setTitle:function(e){var n=this.form.parentNode.id.split("_").pop(),o=t("#returnmessage_"+n);o&&0!=trim(o.html()).length&&o.html(e)},login_run:function(n){function o(){var e=u.ele(".v-login-form")[0],o=e.ele(".vaptcha_container"),r=e.ele("input");if(i.setTitle(n.lang.login_member),!p){p=!0;var s=function(){var t=i.getFormData(e);t.user.length>0&&e.getInput("user").removeClass("error"),t.password.length>5&&e.getInput("password").removeClass("error"),t.user.length>0&&t.password.length>5?e.ele(".login-button")[0].removeAttribute("disabled"):e.ele(".login-button")[0].setAttribute("disabled","disabled")};n.login_captcha&&(d=i.initVaptcha({scene:"01",element:o,form:e,success:s})),r.call("addEvent","keyup",s),r.call("addEvent","blur",s),n.code_login&&e.ele(".sms-login-tab")[0].addEvent("click",function(n){e.addClass("none"),t(".v-sms-login-form")[0].removeClass("none"),a()}),e.ele(".login-button")[0].addEvent("click",function(t){i.ajax({url:"/plugin.php?id=phone_auth&mod=logging&action=login&loginsubmit=yes",type:"POST",data:i.getFormData(e),success:function(e){window.location.href=window.location.href},error:function(t){if(["user","password","vaptcha"].indexOf(t.error_pos)>=0&&(e.getInput(t.error_pos)&&e.getInput(t.error_pos).addClass("error"),t.msg&&i.showMsg(t.msg)),"location_activation"===t.error_pos)return window.location.href=t.msg;t.msg&&i.showMsg(t.msg),n.login_captcha&&d.refresh(),e.ele(".login-button")[0].setAttribute("disabled","disabled")}})})}}function a(){var e=u.ele(".v-sms-login-form")[0],n=e.ele(".vaptcha_container"),o=e.ele(".dz-btn-code")[0],a=e.ele("input"),r=e.ele(".login-button")[0];if(!h){var s=function(){var t=i.getFormData(e);i.isPhone(t.phone)&&/^\d{6}$/.test(t.code)?r.removeAttribute("disabled"):r.setAttribute("disabled","disabled")};e.getInput("phone").addEvent("keyup",function(e){var t=e.target;!Number(t.value)&&(t.value=parseInt(t.value)?parseInt(t.value):""),i.resetSendCodeBtn(o)}),a.call("addEvent","focus",function(e){e.target.removeClass("error")}),a.call("addEvent","keyup",s),a.call("addEvent","focus",s),h=!0;var l=i.initVaptcha({scene:"01",element:n,form:e,success:function(){o.click(),e.ele(".send-code-group")[0].removeClass("none")}}),d=!1;o.addEvent("click",function(){d||(i.isPhone(e.getInput("phone").value)?(d=!0,i.ajax({url:"/plugin.php?id=phone_auth&action=sendlogincode",type:"POST",data:{phone:e.getInput("phone").value,vaptcha_token:e.getInput("vaptcha_token").value},success:function(e){d=!1,i.showMsg(e.msg,!0),isSend=!0,o.setAttribute("disabled","disabled"),i.buttonCountDown(o,120)},error:function(t){d=!1,"vaptcha"===t.error_pos&&l.refresh(),"phone"===t.error_pos&&e.getInput("phone").addClass("error"),301===t.status?i.buttonCountDown(o,t.msg):i.showMsg(t.msg)}})):e.getInput("phone").addClass("error"))}),r.addEvent("click",function(t){i.ajax({url:"/plugin.php?id=phone_auth&mod=logging&action=smslogin&loginsubmit=yes",type:"POST",data:i.getFormData(e),success:function(e){window.location.reload()},error:function(t){["user","password","vaptcha"].indexOf(t.error_pos)>=0&&(e.getInput(t.error_pos)&&e.getInput(t.error_pos).addClass("error"),t.msg&&i.showMsg(t.msg)),t.msg&&i.showMsg(t.msg),e.ele(".login-button")[0].setAttribute("disabled","disabled")}})}),e.ele(".login-tab")[0].addEvent("click",function(n){e.addClass("none"),t(".v-login-form")[0].removeClass("none")})}}function r(){var o=u.ele(".lost-password-form")[0],a=o.ele(".vaptcha_container"),r=o.ele(".find-password-email")[0],l=o.ele("input"),d=o.ele(".dz-btn-code")[0];if(r){var p=new e;p.addRule(r.getInput("email"),"require","\u90ae\u7bb1\u4e0d\u80fd\u4e3a\u7a7a"),p.addRule(r.getInput("username"),"require","\u7528\u6237\u540d\u4e0d\u80fd\u4e3a\u7a7a"),["email","phone"].forEach(function(e){o.ele("."+e+"-tab")[0].addEvent("click",function(){Array.prototype.forEach.call(o.ele(".find-panel"),function(e){e.style.display="none"}),Array.prototype.forEach.call(o.ele(".dz-tab"),function(e){e.removeClass("active")}),o.ele("."+e+"-tab")[0].addClass("active"),o.ele(".find-password-"+e)[0].style.display="block"})}),emailVaptcha=i.initVaptcha({element:r.ele(".vaptcha_container"),form:r,success:function(){}}),o.ele(".send-email")[0].addEvent("click",function(){var e=p.validate();if(e)return i.showMsg(e);var t=document.createElement("iframe");t.id="postiframe",t.name="postiframe",t.style.display="none",event.target.setAttribute("disabled","disabeled"),document.body.appendChild(t);var n=document.getElementById("lostpwform");return t.onload=function(){var e="";try{e=t.contentWindow.document.XMLDocument.text}catch(n){try{e=t.contentWindow.document.documentElement.firstChild.wholeText}catch(n){try{e=t.contentWindow.document.documentElement.firstChild.nodeValue}catch(t){e="\u5185\u90e8\u9519\u8bef\uff0c\u65e0\u6cd5\u663e\u793a\u6b64\u5185\u5bb9"}}event.target.removeAttribute("disabled")}e.split("'").forEach(function(t){/^[\u4e00-\u9fa5]+/g.test(t)&&(e=t)}),i.showMsg(e),t.parentNode.removeChild(t)},n.submit(),!1})}if(i.setTitle(n.lang.password_reset),v)return l.call("val",""),this.countDownTimer&&clearTimeout(this.countDownTimer),o.getInput("phone").removeAttribute("disabled"),o.ele("button").call("setAttribute","disabled","disabled"),d.removeAttribute("disabled"),d.html(n.lang.send_code),o.ele(".pw-strength")[0].className="pw-strength",void c.refresh();v=!0,c=i.initVaptcha({element:a,form:o,success:function(){g(),d.click(),o.ele(".send-code-group")[0].removeClass("none")}});var h=!1,g=function(){i.isPhone(o.getInput("phone").value)&&o.getInput("phone").removeClass("error"),/^\d{6}$/.test(o.getInput("code").value)&&o.getInput("code").removeClass("error"),i.isPhone(o.getInput("phone").value)&&/^\d{6}$/.test(o.getInput("code").value)?o.ele(".next-step")[0].removeAttribute("disabled"):o.ele(".next-step")[0].setAttribute("disabled","disabled")};l.call("addEvent","keyup",g),o.ele(".next-step")[0].addEvent("click",function(){i.ajax({url:"/plugin.php?id=phone_auth&action=verifyCode",type:"POST",data:{phone:o.getInput("phone").value,code:o.getInput("code").value},success:function(e){o.addClass("none"),t(".reset-password")[0].removeClass("none"),s()},error:function(e){o.ele(".next-step")[0].setAttribute("disabled","disabled"),"phone"==e.error_pos&&o.getInput("phone").addClass("error"),"code"==e.error_pos&&o.getInput("code").addClass("error"),i.showMsg(e.msg)}})}),o.getInput("phone").addEvent("keydown",function(){i.resetSendCodeBtn(d)});var m=!1;d.addEvent("click",function(){m||(g(),m=!0,i.ajax({url:"/plugin.php?id=phone_auth&action=sendcode",type:"POST",data:{phone:o.getInput("phone").value,vaptcha_token:o.getInput("vaptcha_token").value},success:function(e){m=!1,i.showMsg(e.msg,!0),h=!0,d.setAttribute("disabled","disabled"),i.buttonCountDown(d,120)},error:function(e){m=!1,"vaptcha"===e.error_pos&&c.refresh(),"phone"===e.error_pos&&o.getInput("phone").addClass("error"),301===e.status?(h=!0,i.buttonCountDown(d,e.msg)):i.showMsg(e.msg)}}))})}function s(){var e=u.ele(".reset-password")[0],t=e.ele("input");e.getInput("new_password");i.setTitle(n.lang.password_reset),g&&(t.call("val",""),e.ele("button").call("setAttribute","disabled","disabled")),g=!0,i.passwordLevel(e.getInput("new_password"),e.ele(".pw-strength")[0]),t.call("addEvent","keyup",function(){e.getInput("new_password").value.length==e.getInput("verify_password").value.length&&e.getInput("new_password").value.length>5&&e.getInput("new_password").value.length<21?e.ele(".submit-btn")[0].removeAttribute("disabled"):e.ele(".submit-btn")[0].setAttribute("disabled","disabled")}),e.ele(".submit-btn")[0].addEvent("click",function(){i.ajax({url:"/plugin.php?id=phone_auth&action=resetPassword",type:"POST",data:{new_password:e.getInput("new_password").value},success:function(e){i.showMsg(e.msg,!0),setTimeout(function(){u.ele(".vaptcha-dz-popup").call("addClass","none"),u.ele(".v-login-form")[0].removeClass("none"),o()},1e3)},error:function(e){i.showMsg(e.msg)}})})}var i=this,l=t("form[name=login]")[0],u=t("#loginphone_"+n.id);this.form=u,l&&l.parentNode.removeChild(l);var d,c,p=!1,h=!1,v=!1,g=!1,m=function(){u.ele(".vaptcha-dz-popup").call("addClass","none"),u.ele(".lost-password-form")[0].removeClass("none"),r()};t(".lost-password")[0]&&t(".lost-password")[0].addEvent("click",m),n.islostpwd?m():n.bind_phone?function(){var e=u.ele(".bind-phone-form")[0];u.ele(".vaptcha-dz-popup").call("addClass","none"),e.removeClass("none");var t=e.ele(".dz-btn-code")[0];i.setTitle(n.lang.bind_phone);var o=function(){i.isPhone(e.getInput("phone").value)?(e.getInput("phone").removeClass("error"),a.isPass&&6===e.getInput("code").value.length?e.ele(".bind-phone-btn")[0].removeAttribute("disabled"):e.ele(".bind-phone-btn")[0].setAttribute("disabled","disabled")):e.getInput("phone").addClass("error")};n.enable_inter&&(i.initCountryCode(e),e.getInput("country_code").addEvent("keyup",function(e){var t=e.target;!Number(t.value)&&(t.value=parseInt(t.value)?parseInt(t.value):"")}));var a=i.initVaptcha({element:e.ele(".vaptcha_container")[0],form:e,success:function(){t.target("click"),e.ele(".send-code-group")[0].removeClass("none")}});e.ele("input").call("addEvent","blur",o),e.ele("input").call("addEvent","focus",function(e){e.target.removeClass("error")}),e.getInput("code").addEvent("blur",function(e){e.target.target("keyup")}),e.getInput("code").addEvent("keyup",function(e){o(),it=e.target,6!==it.value.length?it.addClass("error"):it.removeClass("error")}),e.getInput("phone").addEvent("keydown",function(){i.resetSendCodeBtn(t)});var r=!1;t.addEvent("click",function(n){i.stopDefault(n),r||(r=!0,i.ajax({url:"/plugin.php?id=phone_auth&action=bindPhoneCode",type:"POST",data:i.getFormData(e),success:function(e){r=!1,i.showMsg(e.msg,!0),t.setAttribute("disabled","disabled"),i.buttonCountDown(t,120)},error:function(n){r=!1,"vaptcha"===n.error_pos&&a.refresh(),"phone"===n.error_pos&&e.getInput("phone").addClass("error"),301===n.status?i.buttonCountDown(t,n.msg):i.showMsg(n.msg)}}))}),e.ele(".bind-phone-btn")[0].addEvent("click",function(t){i.ajax({url:"/plugin.php?id=phone_auth&action=bindPhone",type:"POST",data:i.getFormData(e),success:function(e){200===e.status&&window.location.reload()},error:function(t){"phone"===t.error_pos&&e.getInput("phone").addClass("error"),"vaptcha"===t.error_pos&&a.refresh(),e.ele(".bind-phone-btn")[0].setAttribute("disabled","disabled"),i.showMsg(t.msg)}}),i.stopDefault(t)})}():o()},initCountryCode:function(e){var n=e.ele(".dropdown-menu")[0],o=e.ele(".btn-down")[0],a=function(){n.style.display="block",o.addClass("open")},r=function(){n.style.display="none",o.removeClass("open")};e.getInput("country_code").addEvent("focus",a),o.addEvent("click",function(){n.style.display="block"==n.style.display?r():a()}),t("body")[0].addEvent("click",function(t){var n=t.target;!e.ele(".dropdown")[0].contains(n)&&r()}),n.ele(".dropdown-item").call("addEvent","click",function(t){r(),e.getInput("country_code").value=t.target.innerHTML.split("+")[1].trim()})},register_run:function(e){function n(){var e=s.username&&s.email&&s.password&&s.phone;return e&&s.code&&s.agreebbrule?t("#register_btn").removeAttribute("disabled"):t("#register_btn").setAttribute("disabled","disabled"),e}var o=this,a=t("#registerform"),r=t("#registerphone_"+e.id);this.form=r;var s={username:!1,email:0==e.has_email,password:!1,phone:!1,vaptcha:!1,code:!1,qq:0==e.has_qq,agreebbrule:!0};a.html("");var i=t(".dz-btn-code")[0];if(e.enable_inter&&(this.initCountryCode(r),r.getInput("country_code").addEvent("keyup",function(e){var t=e.target;!Number(t.value)&&(t.value=parseInt(t.value)?parseInt(t.value):""),s.phone=o.isPhone(t.value)})),r.ele("input").call("addEvent","focus",function(e){var t=e.target;t.removeClass("error"),t.next()&&t.next().removeClass("error")}),r.getInput(e.username).addEvent("focus",function(t){t.target.next().html(e.lang.username)}),r.getInput(e.username).addEvent("keyup",function(e){var t=e.target;t.value=trim(t.value),s.username=!(t.value.length<3||t.value.length>15)}),r.getInput(e.username).addEvent("blur",function(e){var t=e.target;t.target("keyup"),s.username=s.username&&!/^\d+$/.test(t.value),s.username||(s.username=!1,t.addClass("error"),t.next().addClass("error"))}),1==e.has_email&&(r.getInput(e.email).addEvent("focus",function(t){t.target.next().html(e.lang.email)}),r.getInput(e.email).addEvent("keyup",function(e){var t=e.target;t.value=trim(t.value),s.email=/^(\w)+(\.\w+)*@(\w)+((\.\w{2,3}){1,3})$/.test(t.value)}),r.getInput(e.email).addEvent("blur",function(t){var n=t.target;n.target("keyup"),s.email||(n.addClass("error"),n.next().addClass("error"),n.next().html(e.lang.email_error))})),e.has_qq&&(r.getInput("qq").addEvent("focus",function(e){e.target.next().html("")}),r.getInput("qq").addEvent("keyup",function(e){var t=e.target;t.value=trim(t.value),t.value&&(s.qq=!0)}),r.getInput("qq").addEvent("blur",function(t){var n=t.target;n.target("keyup"),s.qq||(n.addClass("error"),n.next().addClass("error"),n.next().html(e.lang.qq_error))})),o.passwordLevel(r.getInput(e.password),r.ele(".pw-strength")[0]),r.getInput(e.password).addEvent("blur",function(e){var t=e.target;t.value.length<6||t.value.length>20?(s.password=!1,t.addClass("error"),t.next().addClass("error")):s.password=!0}),r.getInput("phone").addEvent("focus",function(e){e.target.next().html("")}),r.getInput("phone").addEvent("keyup",function(e){var t=e.target;!Number(t.value)&&(t.value=parseInt(t.value)?parseInt(t.value):""),s.phone=o.isPhone(t.value),o.resetSendCodeBtn(i)}),r.getInput("phone").addEvent("blur",function(t){var n=t.target;n.target("keyup"),s.phone||(n.addClass("error"),n.next().addClass("error"),n.next().html(e.lang.phone))}),r.getInput("code").addEvent("keyup",function(e){var t=e.target;t.value=trim(t.value),s.code=/^\d{6}$/.test(t.value)}),r.getInput("code").addEvent("blur",function(e){var t=e.target;t.target("keyup"),!s.code&&t.addClass("error")}),1===e.has_bbrules){r.ele(".protocal-link")[0].addEvent("click",function(){showDialog($("layer_bbrule").innerHTML,"info",""),$("fwin_dialog_close").style.display="none"});var l=function(){s.agreebbrule=t("#agreebbrule").checked,n()};t("#agreebbrule").addEvent("click",l),t("#agreebbrule").next().addEvent("click",l)}r.ele("input").call("addEvent","keyup",n);var u=!1;i.addEvent("click",function(){if(r.getInput("phone").target("blur"),!s.phone||u)return!1;u=!0,o.ajax({url:"/plugin.php?id=phone_auth&action=sendRegisterCode",type:"POST",data:{phone:r.getInput("phone").value,country_code:r.getInput("country_code").value.trim(),vaptcha_token:r.getInput("vaptcha_token").value},success:function(e){u=!1,i.setAttribute("disabled","disabled"),o.buttonCountDown(i,120)},error:function(e){u=!1,"vaptcha"===e.error_pos?(r.ele(".vaptcha_container")[0].next().html(e.msg),o.initVaptcha({element:r.ele(".vaptcha_container"),form:r,success:function(){n(),r.ele(".vaptcha_container")[0].next().html(""),i.target("click")}})):["phone","code"].indexOf(e.error_pos)>=0?(r.getInput(e.error_pos).addClass("error"),r.getInput(e.error_pos).next().addClass("error"),r.getInput(e.error_pos).next().html(e.msg)):301===e.status?o.buttonCountDown(i,e.msg):o.showMsg(e.msg)}})}),t("#register_btn").addEvent("click",function(){o.ajax({url:"/plugin.php?id=phone_auth&action=register",data:o.getFormData(r),type:"POST",success:function(e){200===e.status&&(document.referrer?window.location.href=document.referrer:window.location.reload())},error:function(t){r.getInput(e.username),r.getInput(e.email);["username","email","invitecode"].indexOf(t.error_pos)>-1?(r.getInput(t.error_pos).addClass("error"),r.getInput(t.error_pos).next().addClass("error"),r.getInput(t.error_pos).next().html(t.msg)):t.msg&&o.showMsg(t.msg)}})}),o.initVaptcha({element:r.ele(".vaptcha_container"),form:r,type:"popup",success:function(){s.vaptcha=!0,r.ele(".dz-code-group")[0].removeClass("none"),r.ele(".vaptcha_container")[0].next().html(""),i.target("click"),n()}})},popup_captcha:function(e,n){var o=this;(n=n||t("#popup_vaptcha")).ele(".vp-header")[0].style.marginTop=((window.innerHeight||document.documentElement.clientHeight)-230)/2+"px",n.style.display="block",n.ele(".vp-mask")[0].addEvent("click",function(e){n.style.display="none"}),(void 0===n.is_pass||n.is_pass)&&(n.ele(".vp-content")[0].html('<div class="loading"><span style="animation-delay: -.32s"></span><span style="animation-delay: -.16s"></span><span></span></div>'),function(){var t=o.initVaptcha({scene:"01",element:n.ele(".vp-content"),type:"embed",form:e,success:function(){n.is_pass=!0;var a=o.getFormData(e);a.vaptcha_token=t.vaptcha.getToken(),o.ajax({url:"/plugin.php?id=phone_auth&mod=logging&action=login&loginsubmit=yes",type:"POST",data:a,success:function(e){window.location.reload()},error:function(e){return n.style.display="none","bind_phone"==e.error_pos?showWindow("login","member.php?mod=logging&action=login"):"location_activation"==e.error_pos?window.location.href=e.msg:void(e.msg&&errorhandle_ls(e.msg,{loginperm:"4"}))}})}});n.is_pass=!1}())},login_simple_run:function(e){var n=this,o=t("#lsform").ele(".fastlg")[0],a=o.ele(".pns")[0],r=o.ele(".v-login-simple")[0];o.replaceChild(r,a),r.ele(".login-btn")[0].addEvent("click",function(t){n.stopDefault(t);var o=r.getInput("user"),a=r.getInput("password");o.val()&&a.val()?e.login_captcha?n.popup_captcha(r):n.ajax({url:"/plugin.php?id=phone_auth&mod=logging&action=login&loginsubmit=yes",type:"POST",data:n.getFormData(r),success:function(e){window.location.reload()},error:function(e){if(console.log(e),"bind_phone"==e.error_pos)return showWindow("login","member.php?mod=logging&action=login");e.msg&&errorhandle_ls(e.msg,{loginperm:"4"})}}):showWindow("login","member.php?mod=logging&action=login")})},activation:function(){var e=t("#registerform"),n=this;e.ele("#registerformsubmit").addEvent("click",function(t){t.preventDefault(),n.ajax({type:"POST",url:"/plugin.php?id=phone_auth&action=activation",data:n.getFormData(e),success:function(){window.location.reload()},error:function(e){errorhandle_ls(e.msg,"")}})})}},window.v_helper=n,window.ele=t}();