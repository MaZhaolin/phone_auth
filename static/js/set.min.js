var Pagination=function(t){var t=t||{};this.page=document.querySelector(t.selector||".pagination"),this.nextElement=this.page.querySelector(t.next||".next"),this.prevElement=this.page.querySelector(t.prev||".prev"),this.goButton=this.page.querySelector(t.to||".to"),this.inputPage=this.page.querySelector(t.pageInput||'input[name="page"]'),this.currentPage=t.currentPage||1,this.pageTotal=t.pageTotal||1,this.length=t.length||10,this.changeHandle=t.changeHandle||function(){},this._bindEventlistener()};Pagination.prototype={constructor:Pagination,_createPage:function(t){var e=document.createElement("li"),i=document.createElement("a");i.innerText=t,e.classList.add("page-"+t),e.appendChild(i),this.page.insertBefore(e,this.nextElement),this.items.push(e),"number"==typeof t&&e.addEventListener("click",function(){this.to(Number(e.innerText))}.bind(this))},_createPages:function(){if(this.items=[],this.pageTotal>this.length){this.currentPage>5&&(this._createPage(1),this.currentPage>6&&this._createPage("..."));for(t=this.currentPage-4;t<=this.currentPage+5;t++)t>0&&t<this.pageTotal&&this._createPage(t);this.currentPage<this.pageTotal-5&&this._createPage("..."),this._createPage(this.pageTotal)}else for(var t=1;t<=this.pageTotal;t++)this._createPage(t)},_bindEventlistener:function(){this._createPages(),this.nextElement.addEventListener("click",this.next.bind(this)),this.prevElement.addEventListener("click",this.prev.bind(this)),this.goButton&&this.goButton.addEventListener("click",function(){this.to(Number(this.inputPage.value))}.bind(this)),this.inputPage&&this.inputPage.addEventListener("keyup",function(t){13===(t=t||window.event).keyCode&&this.to(Number(this.inputPage.value))}.bind(this)),this._updateView(!0)},next:function(){return this.currentPage<this.pageTotal&&this.currentPage++,this._updateView(),this},prev:function(){return this.currentPage>1&&this.currentPage--,this._updateView(),this},to:function(t){return t!=this.currentPage&&t<=this.pageTotal&&t>0&&(this.currentPage=t,this._updateView()),this},reset:function(t){t&&(this.pageTotal=t),this.currentPage=1,this._updateView(!0)},_removeDoms:function(){this.items.forEach(function(t){t.remove()})},_updateView:function(t){!t&&this.changeHandle(this.currentPage),this._removeDoms(),this._createPages(),this.items.forEach(function(t){t.classList.remove("active")}),this.page.style.display=this.pageTotal<=1?"none":"inline-block",1===this.currentPage?this.prevElement.classList.add("disabled"):this.prevElement.classList.remove("disabled"),this.currentPage===this.pageTotal?this.nextElement.classList.add("disabled"):this.nextElement.classList.remove("disabled"),this.page.getElementsByClassName("page-"+this.currentPage)[0].classList.add("active")}};var helper=function(t){this.config=t,this.selectedAmount=5e3,this.alipayToken="",this.wechatToken="",this.checkPayTimer,this.page};helper.prototype={constructor:helper,init:function(){this.initSetting(),this.initTabs(),this.initSelectAmount(),this.setAliayUrl(),this.getSendRecord(),this.initPayEvents()},initSetting:function(){$("#picker").colpick({layout:"hex",submit:0,colorScheme:"dark",onChange:function(t,e,i,a,n){$(a).css("border-color","#"+e),n||$(a).val(e)}}).keyup(function(){$(this).colpickSetColor(this.value)})},initTabs:function(){var t=this,e=$(".tab .v-btn"),i=$(".tab-panel");e.click(function(){e.removeClass("active"),i.removeClass("active"),$(this).addClass("active");var a=e.index(this);$(i[a]).addClass("active"),0==a&&t.getOrdersData(),1==a&&t.getSendRecord()})},initSelectAmount:function(){var t=[{price:3.5,num:5e3},{price:3.2,num:2e4},{price:2.8,num:5e4},{price:2.5,num:2e5},{price:2,num:5e5}],e=$(".recharge .prices span"),i=this;e.click(function(a){var n=e.index(this);e.removeClass("active"),$(this).addClass("active"),i.selectedAmount=t[n].num,$("input[name=pay]:checked").val()&&i.setAliayUrl(),$(".recharge .v-money .price-total").text("￥"+(t[n].price*t[n].num/100).toFixed(2)),$(".recharge .v-money .price").text(t[n].price)})},setAliayUrl:function(){var t=this,e=this.config.site_url+"/plugin.php?id=phone_auth&action=smspay&type=alipay&amount="+t.selectedAmount;$.get(e,function(e){t.alipayToken=e.token,$(".online-pay-btn").attr("href",e.url)},"json")},initPayEvents:function(){var t=null,e=this;$(".online-pay-btn").click(function(){if(24!=e.config.params.vid.length||32!=e.config.params.key.length)return $(".vaptcha-dz-tip").show(),t&&clearTimeout(t),t=setTimeout(function(){$(".vaptcha-dz-tip").hide()},1e3),!1;if("wechat"===$("input[name=pay]:checked").val()){var i=e.config.site_url+"/plugin.php?id=phone_auth&action=smspay&type=wechat&amount="+e.selectedAmount;return $.get(i,function(t){e.wechatToken=t.token,$(".wechat-pay img").attr("src","data:image/png;base64, "+t.data),$(".wechat-pay").show(),e.checkPayState(e.wechatToken)},"json"),!1}e.checkPayState(e.alipayToken),$(".alipay-pop").show()}),$(".alipay-pop .finish-pay").click(function(){e.checkPayState(e.alipayToken)})},getOrdersData:function(){var t=this;$.get(this.config.site_url+"/plugin.php?id=phone_auth&action=smsdata&page=0",function(e){if(200===e.code){e=e.data,console.log(e),$(".surplus-count .count").html(e.amount),$(".surplus-day .day").html(e.expecttime);var i="";for(var a in e.orders){var n=e.orders[a];i+="<tr><td>"+n.amount+"</td><td>"+n.payment+"</td><td>"+t.config.lang[n.paytype]+"</td><td>"+n.orderid+"</td><td>"+new Date(n.createtime).toLocaleString()+"</td></tr>"}i&&$(".recharge .record tbody").html(i)}else console.error("get data error")},"json")},getSendRecord:function(t){var e=this;t=t||1,$.get(this.config.site_url+"/plugin.php?id=phone_auth&action=smsdata&type=send&page="+(t-1),function(i){if(200===i.code){i=i.data,t&&e.initStatistics(i.statistics);var a="";for(var n in i.records){var s=i.records[n];a+="<tr><td>"+s.phone+"</td><td>"+s.content+"</td><td>"+s.consume+"</td><td>"+s.type+"</td><td>"+("100"==s.statucode?'<i class="iconfont success">&#xe625;</i>':'<i class="iconfont error">&#xe6b8;</i>')+"</td><td>"+new Date(s.createtime).toLocaleString()+"</td></tr>"}a&&$(".log tbody").html(a),e.page=e.page||new Pagination({pageTotal:Math.ceil(i.total/20),changeHandle:function(){e.getSendRecord(this.currentPage)}})}else console.error("get data error")},"json")},showState:function(t){$(".vaptcha-dz-tip").hide(),$(".pay-"+t).show(),setTimeout(function(){$(".pay-"+t).hide()},5e3)},checkPayState:function(t){var e=this;$.get(this.config.site_url+"/plugin.php?id=phone_auth&action=paycheck&token="+t,function(i){var a=i.data;e.checkPayTimer&&clearTimeout(e.checkPayTimer),"0"==a?e.checkPayTimer=setTimeout(function(){e.checkPayState(t)},1e3):"2"==a?(e.getOrdersData(),$(".vaptcha-dz-pop").hide(),e.showState("success")):e.showState("error")},"json")},initStatistics:function(t){for(var e=echarts.init(document.getElementById("echart")),i=[],a=[],n=0;n<t.length;n++)i.push(t[n].date),a.push(t[n].count);var s={color:["#0088ff"],grid:{left:50,top:20},tooltip:{},legend:{data:["销量"]},xAxis:{type:"category",boundaryGap:!1,data:i},yAxis:{type:"value"},series:[{name:"发送量",type:"line",data:a}]};e.setOption(s)}};